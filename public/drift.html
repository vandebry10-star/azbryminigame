<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<title>Azbry Drift</title>
<style>
:root{--bg:#0b0f12;--ink:#e8f0fb;--accent:#b8ff9a;--panel:rgba(255,255,255,.06);--bd:rgba(255,255,255,.12)}
html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:600 14px/1.3 system-ui,Segoe UI,Roboto,Arial;touch-action:manipulation}
.app{position:fixed;inset:0;display:flex;flex-direction:column}
.stage{position:relative;flex:1}
canvas{position:absolute;inset:0;width:100%;height:100%;display:block;background:#0b0f12;}
.hud{position:absolute;top:8px;left:8px;right:8px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;z-index:10;pointer-events:none}
.hud .pill{padding:6px 10px;border-radius:999px;background:var(--panel);border:1px solid var(--bd);pointer-events:auto}
.top-btns{display:flex;gap:6px}
.btn{padding:8px 12px;border-radius:10px;background:var(--panel);border:1px solid var(--bd);color:var(--ink);font-weight:700}
.controls{position:absolute;left:10px;right:10px;bottom:10px;display:flex;justify-content:space-between;align-items:flex-end;gap:12px;z-index:10}
.controls, .controls *{touch-action:none}
.steer{display:flex;gap:10px}
.big{width:74px;height:74px;border-radius:18px;background:rgba(255,255,255,.08);border:1px solid var(--bd);display:grid;place-items:center;color:var(--ink);font-weight:900;user-select:none}
.big:active,.press{transform:scale(.96);background:rgba(255,255,255,.14)}
.padR{display:flex;gap:10px}
.wide{width:110px;height:74px;border-radius:18px;background:linear-gradient(180deg,var(--accent),#a3f07f);color:#101;border:none;font-weight:900;box-shadow:0 0 14px rgba(184,255,154,.25)}
.hb{width:110px;height:74px;border-radius:18px;background:#ff3760;color:#fff;border:none;font-weight:900}
</style>
</head>
<body>
<div class="app">
  <div class="stage" id="stage">
    <canvas id="game"></canvas>
    <div class="hud">
      <div>
        <span class="pill">Lap: <b id="lap">0</b></span>
        <span class="pill">Time: <b id="lapTime">0.000</b>s</span>
        <span class="pill">Speed: <b id="speed">0</b> km/h</span>
        <span class="pill">FPS: <b id="fps">60</b></span>
      </div>
      <div class="top-btns">
        <button id="btnReset" class="btn">Reset</button>
        <a href="./index.html" class="btn">Menu</a>
      </div>
    </div>

    <div class="controls">
      <div class="steer">
        <div class="big" data-hold="KeyA">⟵</div>
        <div class="big" data-hold="KeyD">⟶</div>
      </div>
      <div class="padR">
        <div class="wide" data-hold="KeyW">GAS</div>
        <div class="big hb" data-hold="Space">HB</div>
        <div class="wide" data-hold="KeyS">REM</div>
      </div>
    </div>
  </div>
</div>

<script>
(()=>{
const stage=document.getElementById('stage');
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
function resize(){
  const dpr=Math.min(window.devicePixelRatio||1,2);
  const w=(stage.clientWidth||innerWidth)*dpr;
  const h=(stage.clientHeight||innerHeight)*dpr;
  canvas.width=w;canvas.height=h;
}
resize();window.addEventListener('resize',resize);
const W=()=>canvas.width,H=()=>canvas.height;

// --- HUD
const $lap=document.getElementById('lap'),$lapTime=document.getElementById('lapTime'),
$fps=document.getElementById('fps'),$speed=document.getElementById('speed');

// --- track & car
let gates=[{x:W()*0.2,y:H()*0.7},{x:W()*0.8,y:H()*0.7},{x:W()*0.5,y:H()*0.25}];
const car={x:W()*0.2,y:H()*0.8,angle:-Math.PI/2,vx:0,vy:0,angVel:0,steer:0,throttle:0,hb:false};
const keys={};
function reset(){car.x=W()*0.2;car.y=H()*0.8;car.vx=car.vy=car.angVel=car.steer=0;}
document.getElementById('btnReset').onclick=reset;

// --- mobile controls
function bindHold(el){
  const code=el.dataset.hold;
  const start=e=>{e.preventDefault();keys[code]=true;el.classList.add('press');};
  const end=e=>{e.preventDefault();keys[code]=false;el.classList.remove('press');};
  el.addEventListener('touchstart',start,{passive:false});
  el.addEventListener('touchend',end,{passive:false});
  el.addEventListener('mousedown',start);
  el.addEventListener('mouseup',end);
  window.addEventListener('mouseup',()=>{keys[code]=false;el.classList.remove('press');});
}
document.querySelectorAll('[data-hold]').forEach(bindHold);
window.addEventListener('keydown',e=>{keys[e.code]=true;});
window.addEventListener('keyup',e=>{keys[e.code]=false;});

// --- physics
const P={engine:9500,brake:8000,air:0.9,grip:0.9,hbGrip:0.5,maxSpeed:60,steerSpeed:4,maxSteer:0.7};
function step(dt){
  const t=(keys.KeyW?1:0)-(keys.KeyS?1:0);
  const steer=(keys.KeyD?1:0)-(keys.KeyA?1:0);
  car.throttle=t;car.hb=!!keys.Space;
  car.steer+=steer*P.steerSpeed*dt;car.steer=Math.max(-1,Math.min(1,car.steer));
  const c=Math.cos(car.angle),s=Math.sin(car.angle);
  const lx=c*car.vx+s*car.vy,ly=-s*car.vx+c*car.vy;
  let Fx=car.throttle*P.engine;if(keys.KeyS&&lx>0)Fx-=P.brake;
  const speed=Math.hypot(car.vx,car.vy);
  if(speed>P.maxSpeed)Fx*=0.7;
  const slip=ly;
  const Fy=-8*slip*(car.hb?P.hbGrip:P.grip);
  const Fxw=c*Fx-s*Fy,Fyw=s*Fx+c*Fy;
  car.vx+=(Fxw)*dt;car.vy+=(Fyw)*dt;
  car.vx*=Math.pow(P.air,dt*60);car.vy*=Math.pow(P.air,dt*60);
  car.x+=car.vx*dt;car.y+=car.vy*dt;
  car.angle+=car.steer*car.vx*0.015;
}

// --- draw
function draw(){
  const w=W(),h=H();
  ctx.clearRect(0,0,w,h);
  ctx.strokeStyle='rgba(184,255,154,.25)';
  ctx.lineWidth=4;ctx.beginPath();
  ctx.moveTo(gates[0].x,gates[0].y);ctx.lineTo(gates[1].x,gates[1].y);
  ctx.lineTo(gates[2].x,gates[2].y);ctx.closePath();ctx.stroke();
  ctx.save();ctx.translate(car.x,car.y);ctx.rotate(car.angle);
  ctx.fillStyle='#1b90ff';ctx.fillRect(-20,-10,40,20);
  ctx.fillStyle='#fff';ctx.fillRect(-6,-9,12,18);
  ctx.restore();
}

let last=performance.now(),lapStart=last;
function loop(now){
  const dt=Math.min(0.033,(now-last)/1000);last=now;
  step(dt);draw();
  $lapTime.textContent=((now-lapStart)/1000).toFixed(3);
  $speed.textContent=(Math.hypot(car.vx,car.vy)*3.6)|0;
  $fps.textContent=(1/dt)|0;
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
})();
</script>
</body>
</html>
