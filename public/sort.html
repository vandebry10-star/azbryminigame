<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Azbry ‚Ä¢ Color Sort Neon</title>

<link rel="stylesheet" href="/assets/css/azbry.css">

<style>
:root{
  --ink:#eaf3ea; --muted:#aeb9c5;
  --bd:rgba(255,255,255,.06);
  --ring:rgba(184,255,154,.22);
  --accent:#b8ff9a; --accent2:#94ef89;
}
*{box-sizing:border-box}
.wrap{max-width:980px;margin:0 auto;padding:22px 16px 90px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
h1{margin:0;font-size:clamp(20px,3.6vw,28px);font-weight:900;color:var(--accent);text-shadow:0 0 16px var(--ring)}
.badge{padding:10px 14px;border:1px solid var(--bd);border-radius:24px;color:#cfead6;background:rgba(184,255,154,.09);font-weight:800}

.panel{
  border:1px solid var(--bd);
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));
  border-radius:18px; box-shadow:0 14px 40px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.03);
}
.topbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;padding:10px}
.btn{
  padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.04);color:#eaf3ea;font-weight:800;cursor:pointer;transition:.18s;
}
.btn:hover{transform:translateY(-1px);opacity:.95}
.btn.accent{background:linear-gradient(180deg,var(--accent),var(--accent2)); color:#0b0d10; border-color:transparent;box-shadow:0 10px 26px rgba(184,255,154,.28)}
.stat{margin-left:auto;font-weight:800;color:#d8e9dc}
.hint{margin-top:8px;padding:10px 12px;border-radius:12px;background:rgba(184,255,154,.08);border:1px solid var(--bd);color:#dfffe4;font-weight:800}

/* GRID */
.board{margin-top:14px;padding:18px;display:grid;gap:22px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}

/* TABUNG */
.tube{
  position:relative; height:300px; cursor:pointer;
  display:flex; align-items:flex-end; justify-content:center; padding:16px 0 18px;
  border-radius:26px; background:transparent; transition:.18s ease;
}
.tube.sel{outline:3px solid var(--ring); border-radius:28px}
.tube.tiltL .glass{transform:rotate(-6deg); transform-origin:20% 0}
.tube.tiltR .glass{transform:rotate(6deg); transform-origin:80% 0}

/* bibir mulut tabung (lebih tipis) */
.tube::before{
  content:""; position:absolute; top:6px; left:50%; transform:translateX(-50%);
  width:84%; height:14px; border-radius:999px;
  background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
  box-shadow:0 1px 0 rgba(0,0,0,.25), inset 0 0 0 2px rgba(0,0,0,.12);
}

/* rongga kaca */
.glass{
  position:absolute; inset:18px 28px 14px; border-radius:20px 20px 48px 48px;
  background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.015));
  border:8px solid rgba(235,240,244,.95);
  box-shadow:inset 0 0 0 2px rgba(0,0,0,.13), 0 12px 24px rgba(0,0,0,.35);
  transition:transform .28s ease;
  pointer-events:none;
}

/* area tumpukan cairan */
.stack{
  position:absolute; left:50%; bottom:24px; transform:translateX(-50%);
  width: calc(100% - 28px - 28px - 16px);
  display:flex; flex-direction:column-reverse; align-items:center; gap:8px;
}
.slot{
  width:100%; height:46px; border-radius:12px; display:grid; place-items:center;
  font-weight:900; letter-spacing:.3px; color:#0b0d10;
  box-shadow:0 6px 16px rgba(0,0,0,.25), inset 0 0 0 1px rgba(0,0,0,.12);
  transition:transform .22s ease, opacity .22s ease;
}
.slot.empty{
  background:transparent; border:1px dashed rgba(184,255,154,.18);
  color:#cfead6;
}
.slot.bottom{ border-bottom-left-radius:36px; border-bottom-right-radius:36px }

/* ‚Äúghost‚Äù untuk animasi terbang */
.ghost{
  position:fixed; z-index:50; pointer-events:none; will-change:transform,left,top;
  box-shadow:0 10px 24px rgba(0,0,0,.35), inset 0 0 0 1px rgba(0,0,0,.12);
  border-radius:12px;
}

/* splash kecil di tujuan */
.splash{
  position:absolute; left:50%; transform:translateX(-50%);
  bottom:24px; width:0; height:0; border-radius:12px; opacity:0; pointer-events:none;
}
.splash.show{animation:splash .35s ease}
@keyframes splash{
  0%{width:10%; height:8px; opacity:.0}
  40%{width:110%; height:10px; opacity:.35}
  100%{width:100%; height:0; opacity:0}
}

@media (max-width:560px){
  .tube{height:260px}
  .slot{height:40px}
}
.footer{margin-top:16px;padding:10px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1>Azbry ‚Ä¢ Color Sort Neon</h1>
      <span class="badge">Satisfying ‚Ä¢ Test-Tube</span>
    </header>

    <div class="panel topbar">
      <button class="btn accent" id="btnShuffle">Shuffle</button>
      <button class="btn" id="btnUndo">Undo</button>
      <button class="btn" id="btnReset">Reset</button>
      <button class="btn" id="btnNext">Next Level</button>
      <div class="stat">Level <span id="lv">1</span> ‚Ä¢ Move <span id="mv">0</span></div>
    </div>

    <div class="hint">Hint: klik tabung asal ‚Üí klik tabung tujuan. Satukan warna per tabung.</div>

    <section id="board" class="board"></section>

    <div class="footer">¬© Azbry Neon Dark ‚Ä¢ FebryWesker</div>
  </main>

<script>
(() => {
  /* ====== Audio kecil ====== */
  let actx;
  function blip(f=620,d=.06,g=.07){
    try{
      if(!actx) actx=new (window.AudioContext||window.webkitAudioContext)();
      const o=actx.createOscillator(), ga=actx.createGain();
      o.type="sine"; o.frequency.value=f; ga.gain.value=g;
      o.connect(ga); ga.connect(actx.destination);
      o.start(); o.stop(actx.currentTime+d);
    }catch(_){}
  }

  /* ====== Level data ====== */
  const LEVELS = [
    { colors:4, height:4, tubes:6, data:[1,2,3,4, 1,2,3,4, 1,2,3,4, 1,2,3,4] },
    { colors:5, height:4, tubes:7, data:[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5,1,2,3,4,5] },
    { colors:6, height:4, tubes:8, data:[1,2,3,4,5,6, 1,2,3,4,5,6, 1,2,3,4,5,6, 1,2,3,4,5,6] }
  ];
  const PALET = {
    1:["#B8FF9A","#8EE887"], 2:["#9ad1ff","#83bfff"], 3:["#feb4ff","#f090ff"],
    4:["#ffd69a","#ffb870"], 5:["#a2ffea","#79f5d8"], 6:["#d4ff9a","#b8ff6a"]
  };

  /* ====== Utils ====== */
  const rand=a=>a[Math.floor(Math.random()*a.length)];
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
  const clone = (t)=>t.map(s=>s.slice());

  /* ====== State ====== */
  let curLevel=0, height=4, tubes=[], moves=0, sel=-1;
  const history=[];
  const elBoard=document.getElementById('board'), elLv=document.getElementById('lv'), elMv=document.getElementById('mv');

  /* ====== Render ====== */
  function render(){
    elBoard.innerHTML="";
    tubes.forEach((stack,idx)=>{
      const tube=document.createElement('div'); tube.className='tube'+(sel===idx?' sel':''); tube.dataset.idx=idx;
      const glass=document.createElement('div'); glass.className='glass'; tube.appendChild(glass);
      const spl=document.createElement('div'); spl.className='splash'; tube.appendChild(spl);

      const stWrap=document.createElement('div'); stWrap.className='stack';
      for(let i=0;i<height;i++){
        const slot=document.createElement('div'); slot.className='slot';
        if(i<stack.length){
          const v=stack[i]; // bottom-first
          slot.style.background=`linear-gradient(180deg, ${PALET[v][0]}, ${PALET[v][1]})`;
          if(i===0) slot.classList.add('bottom');
        }else{
          slot.classList.add('empty');
        }
        stWrap.appendChild(slot);
      }
      tube.appendChild(stWrap);
      elBoard.appendChild(tube);
    });
    elMv.textContent=moves; elLv.textContent=(curLevel+1);
  }

  /* ====== Rules ====== */
  function canMove(from,to){
    if(from===to) return false;
    const A=tubes[from], B=tubes[to];
    if(A.length===0) return false;
    if(B.length>=height) return false;
    const topA=A[A.length-1];
    if(B.length===0) return true;
    return B[B.length-1]===topA;
  }

  /* ====== Animate transfer ====== */
  function animateTransfer(from,to,done){
    // elemen UI posisi asal & tujuan
    const tubeEls=[...document.querySelectorAll('.tube')];
    const tFrom=tubeEls[from], tTo=tubeEls[to];
    const sFromTop = tFrom.querySelector('.stack').children[height - tubes[from].length]; // index DOM atas
    const sToNext  = tTo.querySelector('.stack').children[height - tubes[to].length - 1] || tTo.querySelector('.stack').children[0];

    // clone ghost
    const rectFrom=sFromTop.getBoundingClientRect();
    const ghost=sFromTop.cloneNode(true);
    ghost.classList.add('ghost');
    ghost.style.left=rectFrom.left+'px';
    ghost.style.top=rectFrom.top+'px';
    ghost.style.width=rectFrom.width+'px';
    ghost.style.height=rectFrom.height+'px';
    document.body.appendChild(ghost);

    // tilt visual
    tFrom.classList.add('tiltL');
    const rectTo=sToNext.getBoundingClientRect();

    // animasi ke tujuan (sedikit arc)
    const dx=rectTo.left-rectFrom.left, dy=rectTo.top-rectFrom.top;
    const dur=260;
    ghost.animate([
      { transform:'translate(0,0)', offset:0 },
      { transform:`translate(${dx*0.6}px, ${dy-30}px)`, offset:.6 },
      { transform:`translate(${dx}px, ${dy}px)` }
    ], { duration:dur, easing:'cubic-bezier(.16,1,.3,1)' });

    setTimeout(()=>{
      ghost.remove();
      tFrom.classList.remove('tiltL'); tTo.classList.add('tiltR');
      // splash kecil
      const splash=tTo.querySelector('.splash'); splash.style.background=sFromTop.style.background; splash.classList.add('show');
      setTimeout(()=>{ splash.classList.remove('show'); tTo.classList.remove('tiltR'); }, 320);
      done();
    }, dur);
  }

  function move(from,to){
    if(!canMove(from,to)) { blip(180,.05,.06); return false; }
    // commit setelah animasi selesai
    const before=clone(tubes);
    const v=tubes[from][tubes[from].length-1];
    animateTransfer(from,to,()=>{
      history.push(before);
      tubes[from].pop(); tubes[to].push(v);
      moves++; blip(700,.05,.06);
      render(); checkWin();
    });
    return true;
  }

  function isSolved(){
    return tubes.every(st => st.length===0 || (st.length===height && st.every(v=>v===st[0])));
  }
  function checkWin(){
    if(isSolved()){
      blip(520,.08,.08); blip(720,.08,.08); blip(960,.1,.1);
      setTimeout(()=>alert('Level Clear! üéâ'),10);
    }
  }

  /* ====== Init & events ====== */
  function loadLevel(id){
    const L=LEVELS[id%LEVELS.length];
    curLevel=id%LEVELS.length; height=L.height; moves=0; sel=-1; history.length=0;
    const pool=L.data.slice(); shuffle(pool);
    tubes=Array.from({length:L.tubes},()=>[]);
    let k=0; for(let t=0;t<L.tubes-2;t++){ for(let h=0;h<height;h++) tubes[t].push(pool[k++]) }
    render();
  }

  elBoard.addEventListener('click',e=>{
    const T=e.target.closest('.tube'); if(!T) return; const i=+T.dataset.idx;
    if(sel===-1){ if(tubes[i].length===0){ blip(200,.05,.05); return } sel=i; blip(420,.04,.06); document.querySelectorAll('.tube').forEach(x=>x.classList.remove('sel')); T.classList.add('sel'); }
    else{
      document.querySelectorAll('.tube').forEach(x=>x.classList.remove('sel'));
      if(i===sel){ sel=-1; render(); return }
      move(sel,i); sel=-1;
    }
  });

  document.getElementById('btnShuffle').addEventListener('click',()=>loadLevel(curLevel));
  document.getElementById('btnUndo').addEventListener('click',()=>{
    const p=history.pop(); if(p){ tubes=p; moves=Math.max(0,moves-1); blip(300,.05,.05); render(); } else blip(160,.05,.05);
  });
  document.getElementById('btnReset').addEventListener('click',()=>loadLevel(curLevel));
  document.getElementById('btnNext').addEventListener('click',()=>loadLevel(curLevel+1));

  loadLevel(0);
})();
</script>
</body>
</html>
