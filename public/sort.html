<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Azbry â€¢ Color Sort Neon</title>

<!-- Tema global Azbry (pakai bg assets/img/bg.png dari css tsb) -->
<link rel="stylesheet" href="/assets/css/azbry.css">

<style>
/* ====== Hanya styling komponen game (tanpa mengubah background azbry.css) ====== */
:root{
  --ink:#eaf3ea;
  --muted:#aeb9c5;
  --bd:rgba(255,255,255,.06);
  --ring:rgba(184,255,154,.22);
  --accent:#b8ff9a; --accent2:#94ef89;
}
*{box-sizing:border-box}
.wrap{max-width:980px;margin:0 auto;padding:22px 16px 90px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
h1{margin:0;font-size:clamp(20px,3.6vw,28px);font-weight:900;color:var(--accent);text-shadow:0 0 16px var(--ring)}
.badge{padding:8px 12px;border:1px solid var(--bd);border-radius:999px;color:#cfead6;background:rgba(184,255,154,.09);font-weight:800}

.panel{
  border:1px solid var(--bd);
  background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));
  border-radius:18px; box-shadow:0 14px 40px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.03);
}
.topbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;padding:10px}
.btn{
  padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.04);color:#eaf3ea;font-weight:800;cursor:pointer;transition:.18s;
}
.btn:hover{transform:translateY(-1px);opacity:.95}
.btn.accent{background:linear-gradient(180deg,var(--accent),var(--accent2)); color:#0b0d10; border-color:transparent;box-shadow:0 10px 26px rgba(184,255,154,.28)}
.stat{margin-left:auto;font-weight:800;color:#d8e9dc}
.hint{margin-top:8px;padding:10px 12px;border-radius:12px;background:rgba(184,255,154,.08);border:1px solid var(--bd);color:#dfffe4;font-weight:800}

/* ====== GRID ====== */
.board{margin-top:14px;padding:18px;display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}

/* ====== TABUNG GAYA TEST-TUBE ======
   - .tube = rangka luar
   - .tube::before = bibir/mulut tabung
   - .glass = rongga kaca di dalam
*/
.tube{
  position:relative; height:300px; cursor:pointer;
  display:flex; align-items:flex-end; justify-content:center; padding:14px 0 16px;
  border-radius:26px; background:transparent;
}
.tube::before{
  /* bibir mulut tabung (oval tipis) */
  content:""; position:absolute; top:6px; left:50%; transform:translateX(-50%);
  width:76%; height:18px; border-radius:999px;
  background:linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.6));
  box-shadow:0 2px 0 rgba(0,0,0,.2), inset 0 0 0 2px rgba(0,0,0,.15);
  opacity:.85;
}
.tube.sel{outline:3px solid var(--ring); border-radius:28px}

/* Rongga kaca berbentuk pipa: tebal dinding abu terang, bawah membulat */
.glass{
  position:absolute; inset:18px 28px 14px; border-radius:20px 20px 48px 48px;
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); /* isi */
  border:8px solid rgba(220,230,236,.9);           /* dinding kaca putih */
  box-shadow:
    inset 0 0 0 2px rgba(0,0,0,.12),               /* tepi dalam */
    0 10px 22px rgba(0,0,0,.35);                   /* bayangan luar */
  pointer-events:none;
}

/* Slot cairan di dalam kaca */
.stack{
  position:absolute; left:50%; bottom:24px; transform:translateX(-50%);
  width: calc(100% - 28px - 28px - 16px);          /* (inset L+R + tebal dinding + margin) */
  display:flex; flex-direction:column-reverse; align-items:center; gap:8px;
}
.slot{
  width:100%; height:46px; border-radius:12px; display:grid; place-items:center;
  font-weight:900; letter-spacing:.3px; color:#0b0d10;
  box-shadow:0 6px 16px rgba(0,0,0,.25), inset 0 0 0 1px rgba(0,0,0,.12);
}
.slot.empty{
  background:transparent; border:1px dashed rgba(184,255,154,.18);
  color:#cfead6;
}
/* segmen paling bawah: dasar melengkung mengikuti test tube */
.slot.bottom{ border-bottom-left-radius:36px; border-bottom-right-radius:36px }

/* mobile tweak */
@media (max-width:560px){
  .tube{height:260px}
  .slot{height:40px}
}
.footer{margin-top:16px;padding:10px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1>Azbry â€¢ Color Sort Neon</h1>
      <span class="badge">Satisfying â€¢ Test-Tube</span>
    </header>

    <div class="panel topbar">
      <button class="btn accent" id="btnShuffle">Shuffle</button>
      <button class="btn" id="btnUndo">Undo</button>
      <button class="btn" id="btnReset">Reset</button>
      <button class="btn" id="btnNext">Next Level</button>
      <div class="stat">Level <span id="lv">1</span> â€¢ Move <span id="mv">0</span></div>
    </div>

    <div class="hint">Hint: klik tabung asal â†’ klik tabung tujuan. Satukan warna per tabung.</div>

    <section id="board" class="board"></section>

    <div class="footer">Â© Azbry Neon Dark â€¢ FebryWesker</div>
  </main>

<script>
(() => {
  // ====== WebAudio blip ======
  let actx; function ping(f=640,d=.06,g=.08){try{if(!actx)actx=new (window.AudioContext||window.webkitAudioContext)();const o=actx.createOscillator(),ga=actx.createGain();o.frequency.value=f;o.type="sine";ga.gain.value=g;o.connect(ga);ga.connect(actx.destination);o.start();o.stop(actx.currentTime+d)}catch(_){}}

  // ====== Level data ======
  const LEVELS = [
    { colors:4, height:4, tubes:6, data:[1,2,3,4, 1,2,3,4, 1,2,3,4, 1,2,3,4] },
    { colors:5, height:4, tubes:7, data:[1,1,2,2,3,3,4,4,5,5,1,2,3,4,5,1,2,3,4,5] },
    { colors:6, height:4, tubes:8, data:[1,2,3,4,5,6, 1,2,3,4,5,6, 1,2,3,4,5,6, 1,2,3,4,5,6] }
  ];
  const PALET = {
    1:["#B8FF9A","#8EE887"], 2:["#9ad1ff","#83bfff"], 3:["#feb4ff","#f090ff"],
    4:["#ffd69a","#ffb870"], 5:["#a2ffea","#79f5d8"], 6:["#d4ff9a","#b8ff6a"]
  };

  // ====== State ======
  let curLevel=0, height=4, tubes=[], moves=0, sel=-1;
  const history=[];
  const rand=a=>a[Math.floor(Math.random()*a.length)];
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
  function clone(){return tubes.map(t=>t.slice())}

  const elBoard=document.getElementById('board'), elLv=document.getElementById('lv'), elMv=document.getElementById('mv');

  // ====== Render ======
  function render(){
    elBoard.innerHTML="";
    tubes.forEach((stack,idx)=>{
      const tube=document.createElement('div'); tube.className='tube'+(sel===idx?' sel':''); tube.dataset.idx=idx;

      // inner glass visual
      const glass=document.createElement('div'); glass.className='glass'; tube.appendChild(glass);

      // stack area
      const stWrap=document.createElement('div'); stWrap.className='stack';

      // dari bawah ke atas => i=0 posisi bawah
      for(let i=0;i<height;i++){
        const s=document.createElement('div'); s.className='slot';
        if(i<stack.length){
          const v=stack[i]; // bottom-first
          s.style.background=`linear-gradient(180deg, ${PALET[v][0]}, ${PALET[v][1]})`;
          s.classList.remove('empty');
          if(i===0) s.classList.add('bottom'); // segmen paling bawah membulat
        }else{
          s.classList.add('empty');
        }
        stWrap.appendChild(s);
      }
      tube.appendChild(stWrap);
      elBoard.appendChild(tube);
    });
    elMv.textContent=moves; elLv.textContent=(curLevel+1);
  }

  // ====== Rules ======
  function canMove(from,to){
    if(from===to) return false;
    const A=tubes[from], B=tubes[to];
    if(A.length===0) return false;
    if(B.length>=height) return false;
    const ball=A[A.length-1];
    if(B.length===0) return true;
    return B[B.length-1]===ball;
  }
  function move(from,to){
    if(!canMove(from,to)) return false;
    history.push(clone());
    const ball=tubes[from].pop();
    tubes[to].push(ball);
    moves++; ping(700,.05,.06);
    render(); checkWin(); return true;
  }
  function isSolved(){
    return tubes.every(st => st.length===0 || (st.length===height && st.every(v=>v===st[0])));
  }
  function checkWin(){
    if(isSolved()){
      ping(520,.08,.08); ping(720,.08,.08); ping(960,.1,.1);
      setTimeout(()=>alert('Level Clear! ðŸŽ‰'),10);
    }
  }

  // ====== Init ======
  function loadLevel(id){
    const L=LEVELS[id%LEVELS.length];
    curLevel=id%LEVELS.length; height=L.height; moves=0; sel=-1; history.length=0;
    const pool=L.data.slice(); shuffle(pool);
    tubes=Array.from({length:L.tubes},()=>[]);
    // isi (sisakan 2 kosong)
    let k=0; for(let t=0;t<L.tubes-2;t++){ for(let h=0;h<height;h++) tubes[t].push(pool[k++]) }
    render();
  }

  // ====== Events ======
  elBoard.addEventListener('click',e=>{
    const T=e.target.closest('.tube'); if(!T) return; const i=+T.dataset.idx;
    if(sel===-1){ if(tubes[i].length===0){ ping(180,.04,.05); return } sel=i; ping(420,.04,.06) }
    else{ if(i===sel){ sel=-1; render(); return } move(sel,i); sel=-1 }
    render();
  });
  document.getElementById('btnShuffle').addEventListener('click',()=>loadLevel(curLevel));
  document.getElementById('btnUndo').addEventListener('click',()=>{const p=history.pop(); if(p){tubes=p;moves=Math.max(0,moves-1);ping(300,.05,.05);render()}else ping(160,.04,.05)});
  document.getElementById('btnReset').addEventListener('click',()=>loadLevel(curLevel));
  document.getElementById('btnNext').addEventListener('click',()=>loadLevel(curLevel+1));

  loadLevel(0);
})();
</script>
</body>
</html>
