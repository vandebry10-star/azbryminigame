<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<title>Popbry — Azbry-MD</title>
<meta name="description" content="Popcat bertema Azbry: klik kucing, mulut mangap, suara pop, skor lokal & global."/>
<style>
  :root{
    --bg:#07090d; --panel:#0b1016; --text:#e6f0ff; --muted:#93a3b8;
    --neon:#39ff14; --neon2:#9dffcf; --ring:#39ff1499; --radius:18px;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    background:#0b0d10 url('assets/img/bg.png') center/cover no-repeat fixed;
    overflow:hidden;
  }

  /* Frame */
  .wrap{position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
        padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);}
  .stage{
    position:relative; width:min(100vw,900px); height:min(100vh,1000px);
    border:2px solid rgba(57,255,20,.25); border-radius:22px; overflow:hidden;
    background:linear-gradient(180deg,rgba(5,8,12,.72),rgba(5,8,12,.35));
    box-shadow:0 0 28px rgba(57,255,20,.22);
  }

  /* Header */
  .topbar{
    position:absolute; inset:0 0 auto 0; height:74px; padding:10px 14px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    background:linear-gradient(180deg,rgba(5,8,12,.85),rgba(5,8,12,.2));
    border-bottom:1px solid rgba(57,255,20,.18);
    z-index:5;
  }
  .brand{font-weight:900; letter-spacing:.3px; color:var(--neon2); text-shadow:0 0 12px var(--ring)}
  .by{color:var(--muted); font-weight:700}

  /* Running neon line */
  .bar{position:absolute; left:10px; right:10px; top:56px; height:4px; background:rgba(57,255,20,.15);
       border-radius:999px; overflow:hidden}
  .bar::before{content:""; position:absolute; inset:0; width:34%;
    background:linear-gradient(90deg,transparent,rgba(57,255,20,.95),transparent);
    animation:sweep 1.8s linear infinite}
  @keyframes sweep{from{transform:translateX(-40%)}to{transform:translateX(140%)}}

  /* Score besar di atas kucing */
  .scoreBig{
    position:absolute; top:100px; left:50%; transform:translateX(-50%);
    font-size:clamp(42px,9vw,76px); font-weight:900; color:var(--neon);
    text-shadow:0 0 14px var(--ring); z-index:4; pointer-events:none;
  }

  /* Kucing tengah */
  .catBox{position:absolute; inset:0; display:flex; align-items:center; justify-content:center}
  .cat{width:min(78vw, 520px); height:auto; filter:drop-shadow(0 0 28px rgba(57,255,20,.25)); user-select:none}

  /* Floaty */
  .floaty{position:fixed; pointer-events:none; font-weight:900; color:var(--neon); text-shadow:0 0 10px var(--ring)}

  /* Footer */
  .footer{
    position:absolute; left:0; right:0; bottom:0; height:62px; padding:10px 14px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    background:linear-gradient(0deg,rgba(5,8,12,.85),rgba(5,8,12,.15));
    border-top:1px solid rgba(57,255,20,.18);
  }
  .left, .right{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
        background:rgba(12,16,22,.6); border:1px solid #1b2534; color:var(--muted)}
  .pill b{color:var(--neon)}
  .link{padding:8px 12px; border:1px solid rgba(57,255,20,.35); border-radius:999px; color:var(--text);
        text-decoration:none; box-shadow:0 0 10px rgba(57,255,20,.15)}
  .center{color:var(--muted); font-size:.92rem; text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="stage" id="frame">
    <!-- HEADER -->
    <div class="topbar">
      <div class="brand">POPBRY (Azbry-MD)</div>
      <div class="by">FebryWesker</div>
      <div class="bar"></div>
    </div>

    <!-- BIG SCORE -->
    <div class="scoreBig" id="scoreBig">0</div>

    <!-- CAT -->
    <div class="catBox">
      <img id="cat" class="cat" src="assets/img/popin.png" alt="Azbry Popbry" draggable="false" />
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <div class="left">
        <span class="pill">Your Clicks: <b id="local">0</b></span>
        <span class="pill">Global: <b id="global">0</b></span>
      </div>
      <div class="center">© 2025 FebryWesker • Azbry-MD</div>
      <div class="right">
        <a class="link" href="https://azbry-minigamez.vercel.app/" target="_blank" rel="noopener">Portofolio</a>
      </div>
    </div>
  </div>
</div>

<script>
  // ====== CONFIG (optional endpoint global) ======
  const LEADERBOARD_URL = null; // ex: 'https://example.com/api/total'

  // ====== DOM ======
  const $ = id => document.getElementById(id);
  const el = { frame: $('frame'), cat: $('cat'), score: $('scoreBig'), g: $('global'), l: $('local') };

  // ====== AUDIO POP ======
  const AudioSys = (()=> {
    let ctx=null;
    function ensure(){ if(!ctx) ctx=new (window.AudioContext||window.webkitAudioContext)(); }
    function pop(){ ensure(); const o=ctx.createOscillator(), g=ctx.createGain();
      o.type='square'; o.frequency.value=520; g.gain.value=.06;
      o.connect(g).connect(ctx.destination); o.start();
      o.frequency.exponentialRampToValueAtTime(180, ctx.currentTime+0.08);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.09);
      o.stop(ctx.currentTime+0.1);
    }
    return { pop };
  })();

  // ====== FLOATY ======
  function floaty(text,x,y){
    const n=document.createElement('div'); n.className='floaty'; n.textContent=text;
    n.style.left=x+'px'; n.style.top=y+'px'; n.style.opacity='1';
    document.body.appendChild(n);
    const t0=Date.now();
    (function anim(){
      const t=(Date.now()-t0)/700;
      n.style.transform=`translateY(${-42*t}px)`; n.style.opacity=String(1-t);
      if(t<1) requestAnimationFrame(anim); else n.remove();
    })();
  }

  // ====== STORE (local + optional global) ======
  const fmt = new Intl.NumberFormat('id-ID');
  const Store = (()=>{
    const KEY='azbry_popbry_total_v1';
    let local = Number(localStorage.getItem('azbry_local')||0);
    let total = Number(localStorage.getItem(KEY)||0);

    function ui(){ el.l.textContent = fmt.format(local); el.g.textContent = fmt.format(total); el.score.textContent = fmt.format(local); }
    function cache(){ localStorage.setItem('azbry_local',local); localStorage.setItem(KEY,total); }

    async function pull(){
      if(LEADERBOARD_URL){
        try{ const r=await fetch(LEADERBOARD_URL,{cache:'no-store'}); const j=await r.json(); total = Number(j.total||total); }catch(_){}
      }
      ui();
    }
    async function add(n){
      local += n; total += n; ui(); cache();
      if(LEADERBOARD_URL){
        try{ await fetch(LEADERBOARD_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({delta:n})}); }catch(_){}
      }
    }
    return { pull, add, ui };
  })();

  // ====== MOUTH CONTROL ======
  function openMouth(){ el.cat.src='assets/img/popup.png'; }
  function closeMouth(){ el.cat.src='assets/img/popin.png'; }

  // ====== CLICK ======
  function handleClick(ev){
    const t = ev.touches ? ev.touches[0] : ev;
    const x = t.clientX || innerWidth/2;
    const y = t.clientY || innerHeight/2;

    openMouth(); AudioSys.pop(); Store.add(1);
    floaty('+1', x, y);
    floaty('🐱', x + (Math.random()*28-14), y + (Math.random()*28-14));
    setTimeout(closeMouth,110);
  }

  // Bind (klik di mana saja)
  window.addEventListener('mousedown', handleClick);
  window.addEventListener('touchstart', e=>handleClick(e), {passive:true});
  document.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); handleClick(e); }});

  // Prevent ghost-drag
  el.cat.addEventListener('dragstart', e=>e.preventDefault());

  // BOOT
  Store.pull(); Store.ui();
</script>
</body>
</html>
