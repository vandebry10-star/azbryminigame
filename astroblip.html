<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Astro Blip ‚Äî Azbry-MD</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/css/azbry.css">
<style>
  canvas{position:fixed; inset:0; width:100%; height:100%; touch-action:none; display:block}
  .scoreBig{
    position:fixed; top:64px; left:0; right:0; text-align:center;
    font-size:clamp(28px,7vw,64px); font-weight:900; color:var(--accent);
    text-shadow:0 0 14px var(--ring); pointer-events:none;
  }
  .pillRow{display:flex; gap:8px; align-items:center}
  .hint{
    position:fixed; bottom:64px; left:50%; transform:translateX(-50%);
    color:var(--muted); background:rgba(17,20,24,.45);
    border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:8px 12px;
    font-weight:600;
  }
  .cool{
    display:inline-flex; align-items:center; gap:6px;
    padding:6px 10px; border-radius:999px; background:rgba(184,255,154,.09);
    border:1px solid var(--ring); color:#dfffe0; font-size:12px; font-weight:800;
  }
  .bar{
    width:72px; height:6px; border-radius:999px; background:rgba(255,255,255,.12); overflow:hidden
  }
  .bar > i{display:block; height:100%; width:0%; background:linear-gradient(180deg,var(--accent),var(--accent2))}
</style>
</head>
<body>

<!-- TOPBAR (tema sama dengan index) -->
<div class="topbar">
  <div class="brand">
    <div class="sub">AZBRY-MD ‚Ä¢ MINI GAMES</div>
    <h1 class="title">Astro Blip</h1>
  </div>
  <div class="pillRow">
    <span class="badge">Best: <b id="best" class="neon">0</b></span>
    <span class="cool">CD
      <span class="bar"><i id="cd"></i></span>
    </span>
    <a href="index.html" class="btn">‚Üê Kembali</a>
  </div>
</div>

<!-- TUJUAN / SCORE -->
<div id="score" class="scoreBig">0</div>
<div class="hint">üéØ Tujuan: hancurkan drone sebanyak mungkin. Seret untuk gerak, <b>tap untuk menembak</b> (ada cooldown).</div>

<canvas id="game"></canvas>

<!-- FOOTER (WAJIB) -->
<footer class="footer">
  <span>¬© <span id="y"></span> Azbry-MD</span>
  <span>Lisensi MIT ‚Ä¢ Dikelola oleh FebryWesker ‚Ä¢ <a href="https://azbry-portofolio.vercel.app/" class="neon" target="_blank" rel="noopener">Portofolio</a></span>
</footer>
<script>document.getElementById('y').textContent = new Date().getFullYear();</script>

<script>
(()=>{
// ===== Setup dasar =====
const $ = id => document.getElementById(id);
const canvas = $('game'); const scoreEl = $('score'); const bestEl = $('best'); const cdBar = $('cd');
const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
let W=0, H=0, ctx=null;

function resize(){
  const r = canvas.getBoundingClientRect();
  W = Math.floor(r.width * dpr); H = Math.floor(r.height * dpr);
  canvas.width = W; canvas.height = H;
  ctx = canvas.getContext('2d');
}
addEventListener('resize', resize, {passive:true}); resize();

const fmt = new Intl.NumberFormat('id-ID');
let running=false, last=0, score=0, best=Number(localStorage.getItem('astro_best')||0);
bestEl.textContent = fmt.format(best);

// ===== Player (Tank) =====
const player = {
  x: W*0.5, y: H*0.82, w: 42*dpr, h: 28*dpr, r: 18*dpr,
  speed: 0.9*dpr
};

// ===== Bullets + Cooldown =====
const bullets = [];
const enemies = [];
const particles = [];

const COOLDOWN_MS = 350; // jeda tembak biar ada tantangan
let cdTimer = 0;         // sisa cooldown dalam ms

function updateCooldown(dt){
  cdTimer = Math.max(0, cdTimer - dt);
  // progress bar (0..100)
  const pct = 100 - Math.round((cdTimer / COOLDOWN_MS) * 100);
  cdBar.style.width = Math.max(0, Math.min(100, pct)) + '%';
}

function canShoot(){ return cdTimer <= 0; }

function shoot(){
  if(!canShoot()) return;
  bullets.push({ x: player.x + 0, y: player.y - player.h*0.6, vy: 3.0*dpr });
  cdTimer = COOLDOWN_MS;
  SFX.pew();
}

// ===== Audio =====
const SFX = (()=>{
  let ctx; const ensure=()=>{ if(!ctx) ctx = new (window.AudioContext||window.webkitAudioContext)(); }
  function pew(){
    ensure(); const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='square'; o.frequency.value=880; g.gain.value=0.06; o.connect(g).connect(ctx.destination);
    o.start(); o.frequency.exponentialRampToValueAtTime(260, ctx.currentTime+.1);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+.11); o.stop(ctx.currentTime+.12);
  }
  function boom(){
    ensure(); const o=ctx.createOscillator(), n=ctx.createOscillator(), g=ctx.createGain();
    o.type='sawtooth'; n.type='square'; o.frequency.value=180; n.frequency.value=90; g.gain.value=0.08;
    o.connect(g); n.connect(g); g.connect(ctx.destination); o.start(); n.start();
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+.22); o.stop(ctx.currentTime+.22); n.stop(ctx.currentTime+.22);
  }
  return { pew, boom };
})();

// ===== Spawner musuh =====
function spawnEnemy(){
  const r = rand(14, 28) * dpr;
  enemies.push({ x: rand(r, W-r), y: -r-4, r, vy: rand(0.8,1.4)*dpr });
}
let spawnTimer = 0;

// ===== Utils =====
function rand(min,max){ return Math.random()*(max-min)+min; }
function puff(x,y,color="#39ff14"){
  for(let i=0;i<10;i++){
    particles.push({x,y, vx:rand(-1.2,1.2)*dpr, vy:rand(-1.2,1.2)*dpr, life:1, color});
  }
}

// ===== Input (drag = gerak, tap = tembak) =====
let dragging=false;
function pointerPos(e){
  const t = e.touches? e.touches[0]: e;
  const rect = canvas.getBoundingClientRect();
  return { x:(t.clientX-rect.left)*dpr, y:(t.clientY-rect.top)*dpr };
}
canvas.addEventListener('mousedown', e=>{ dragging=true; const p=pointerPos(e); player.x=p.x; player.y=p.y; shoot(); });
canvas.addEventListener('mousemove', e=>{ if(dragging){ const p=pointerPos(e); movePlayer(p.x,p.y); }});
addEventListener('mouseup', ()=> dragging=false);

canvas.addEventListener('touchstart', e=>{ dragging=true; const p=pointerPos(e); player.x=p.x; player.y=p.y; shoot(); }, {passive:true});
canvas.addEventListener('touchmove',  e=>{ if(dragging){ const p=pointerPos(e); movePlayer(p.x,p.y); }}, {passive:true});
addEventListener('touchend', ()=> dragging=false);

addEventListener('keydown', e=>{
  if(e.code==='Space'){ e.preventDefault(); shoot(); }
});

// batasi player di layar
function movePlayer(nx,ny){
  player.x = Math.max(player.w*0.4, Math.min(W - player.w*0.4, nx));
  player.y = Math.max(H*0.2, Math.min(H*0.95, ny));
}

// ===== Gambar Tank (neon) =====
function drawTank(px,py){
  ctx.save();
  ctx.translate(px,py);
  ctx.shadowColor="#39ff14"; ctx.shadowBlur=16*dpr;

  // body (chassis)
  ctx.fillStyle="#39ff14";
  const bw = player.w, bh = player.h;
  ctx.fillRect(-bw/2, -bh/2, bw, bh);

  // turret (menara)
  ctx.fillRect(-bw*0.18, -bh*0.9, bw*0.36, bh*0.6);

  // cannon (moncong)
  ctx.fillRect(-bw*0.06, -bh*1.35, bw*0.12, bh*0.7);

  // roda (track) aksen
  ctx.shadowBlur=0;
  ctx.strokeStyle="rgba(57,255,20,.45)"; ctx.lineWidth=2*dpr;
  ctx.strokeRect(-bw/2, -bh/2, bw, bh);
  ctx.restore();
}

// ===== Loop =====
function reset(){
  bullets.length=0; enemies.length=0; particles.length=0;
  score=0; spawnTimer=0; cdTimer=0;
  player.x = W*0.5; player.y = H*0.82;
  scoreEl.textContent = "0";
}
function start(){ if(running) return; reset(); running=true; last=performance.now(); requestAnimationFrame(loop); }
function stop(){
  running=false; SFX.boom();
  if(score>best){ best=score; localStorage.setItem('astro_best', String(best)); bestEl.textContent=fmt.format(best); }
}

function loop(t){
  if(!running) return;
  const dt = Math.min(40, t-last); last=t;
  updateCooldown(dt);

  // spawn musuh (bertahap makin cepat)
  spawnTimer += dt;
  const interval = Math.max(350, 900 - score*8); // makin tinggi skor, makin cepat spawn
  if(spawnTimer > interval){ spawnEnemy(); spawnTimer = 0; }

  // update bullets
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i]; b.y -= b.vy;
    if(b.y < -20*dpr) bullets.splice(i,1);
  }
  // update enemies
  for(let i=enemies.length-1;i>=0;i--){
    const e=enemies[i]; e.y += e.vy;
    if(e.y - e.r > H+40*dpr){ enemies.splice(i,1); continue; }
    // collide with player (pakai lingkaran besar di sekitar tank)
    const dx=e.x-player.x, dy=e.y-player.y, rr=(e.r+player.r)*(e.r+player.r);
    if(dx*dx+dy*dy <= rr){ stop(); }
    // collide with bullets
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j]; const bx=e.x-b.x, by=e.y-b.y, r2 = (e.r+6*dpr)*(e.r+6*dpr);
      if(bx*bx+by*by <= r2){
        bullets.splice(j,1); enemies.splice(i,1); puff(e.x,e.y);
        score++; scoreEl.textContent = fmt.format(score);
        break;
      }
    }
  }
  // particles
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.life-=0.02;
    if(p.life<=0) particles.splice(i,1);
  }

  // draw
  ctx.clearRect(0,0,W,H);

  // lantai glow tipis
  ctx.save();
  const grd = ctx.createLinearGradient(0, H*0.6, 0, H);
  grd.addColorStop(0, "rgba(184,255,154,.08)");
  grd.addColorStop(1, "rgba(184,255,154,.02)");
  ctx.fillStyle = grd; ctx.fillRect(0,H*0.6,W,H*0.4);
  ctx.restore();

  // bullets
  ctx.save(); ctx.shadowBlur=10*dpr; ctx.shadowColor="#39ff14"; ctx.fillStyle="#dfffe0";
  bullets.forEach(b=>{ ctx.fillRect(b.x-2*dpr,b.y-10*dpr,4*dpr,10*dpr); });
  ctx.restore();

  // enemies
  enemies.forEach(e=>{
    // drone neon
    ctx.save();
    ctx.shadowBlur=16*dpr; ctx.shadowColor="#9dffcf"; ctx.fillStyle="#9dffcf";
    ctx.beginPath(); ctx.arc(e.x,e.y,e.r,0,Math.PI*2); ctx.fill();
    ctx.shadowBlur=0; ctx.strokeStyle="rgba(184,255,154,.45)"; ctx.lineWidth=2*dpr;
    ctx.beginPath(); ctx.arc(e.x,e.y,e.r*0.6,0,Math.PI*2); ctx.stroke();
    ctx.restore();
  });

  // particles
  particles.forEach(p=>{
    ctx.save(); ctx.globalAlpha = Math.max(0,p.life); ctx.fillStyle=p.color; ctx.shadowBlur=8*dpr; ctx.shadowColor=p.color;
    ctx.fillRect(p.x-2*dpr, p.y-2*dpr, 4*dpr, 4*dpr); ctx.restore();
  });

  // player tank
  drawTank(player.x, player.y);

  requestAnimationFrame(loop);
}

// start on first interaction
addEventListener('pointerdown', ()=>{ if(!running){ start(); } }, {once:true, passive:true});
// pause on blur
addEventListener('visibilitychange', ()=>{ if(document.hidden && running){ stop(); } });

})();
</script>
</body>
</html>
